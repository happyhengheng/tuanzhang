# -*- coding: utf-8 -*-
import re
import pandas as pd
import traceback
import sys
# order_df = pd.read_excel(r"C:\Users\vivie\OneDrive\Desktop\fsdownload\2022-04-13 20-19-41_timeid-819-1649852381_wxåˆ†ææ–‡ä»¶.xlsx",header=0)
# order_df["number", "content"] = order_df['order'].str.split(pat='.', expand=True)
# order_list = order_df["content"].unique().tolist()
# print(order_list)
# for order in order_list:
#     if "-" in order:
#         lou = order.split("-")
compare_list = ["è™Ÿæ¨“","å·æ¥¼  ","å·æ¥¼ ","å·æ¥¼","å·","æ ‹","building","#","-","â€“","âˆ’","ï¼","_","/",".","â€”","ï¼Œ","~","ï½"]
jieci_list = ["ä»½","ç›’","æ¡¶","ç®±", "å¥—","è¢‹","æ–¤", "ä¸ª"]
system_info = sys.platform


# ä¸­æ–‡-
def get_info(a, debug):
    if "win" in system_info:
        print(a, debug)
    if debug == True:
        a = "1. 2303 ç‰ç±³è”¬èœ 2ä»½ å¤§ç™½èœæ°´é¥º 1ä»½" # ok
    first = a.split(".")[0]
    n = first+"."+" "
    if "win" in system_info:
        print(62, n, first, type(first))
    # néœ€è¦ç¡®è®¤æ˜¯å¦å®¤å­˜æ•°å­—
    # status = is_all_number(n)
    first = first.strip()
    status = first.isdigit()
    if "win" in system_info:
        print(status)
    if status:
        try:
            lou, special, room, louceng, mobile_number = matching(n, a)
        except Exception as e:
            print("72e",e)
            traceback.print_exc()
            lou =""
            special =""
            room =""
            louceng = ""
            mobile_number =""
    else:
        lou =""
        special =""
        room =""
        louceng = ""
        mobile_number =""
    if "win" in system_info:
        print(83,"room",room)
    if room.isdigit():
        try:
            if len(mobile_number)>0:
                a1 = a.replace(mobile_number,"")
            else:
                a1 = a
            fenshu_other = a1.split(room)[1]
            if "win" in system_info:
                print(90,fenshu_other)
            detail, shuliang, detail1, shuliang1 = get_shuliang(fenshu_other)
        except Exception as e:
            if "win" in system_info:
                print("94e",e)
            traceback.print_exc()
            detail = ""
            shuliang = ""
            detail1 = ""
            shuliang1 = ""
    else:
        # if len(room) > 0:
        #     fenshu_other = room
        #     room = ""
        # else:
        fenshu_other = a.replace(mobile_number, "", 1, ).replace(n,"",1).replace(lou, "", 1, ).replace(special, "", 1, )
        room = ""
        try:
            if "win" in system_info:
                print(104)
            detail, shuliang, detail1, shuliang1 = get_shuliang(fenshu_other)
        except Exception as e:
            print("94e",e)
            traceback.print_exc()
            detail = ""
            shuliang = ""
            detail1 = ""
            shuliang1 = ""
    if "win" in system_info:
        print(115,lou)
    lou = drop_special_character(lou)
    if "win" in system_info:
        print(lou)
    item = [a, lou, special, room, louceng, detail, shuliang, detail1, shuliang1, mobile_number]
    if "win" in system_info:
        print(item)
    return item


def matching(n, a):
    other = a.replace(n,"")
    # print("107other",other)
    if "å¼„" in other:
        other = other.split("å¼„")[1]
    elif "æ‘" in other:
        other = other.split("æ‘")[1]
    mobile_number = mobile(other)
    if len(mobile_number) > 0:
        other = other.replace(mobile_number,"")
    else:
        mobile_number = ""
    compare_status = False
    for compare in compare_list:
        if compare in other:
            if "win" in system_info:
                print(118,"compare",compare)
            compare_status = True
            # æå–æ•°å­—éƒ¨åˆ† todo
            # lou = get_last_number(lou)
            room_other = other.split(compare)[-1]
            if "win" in system_info:
                print("room_other",room_other)
            room_other = compare + room_other
            room_other = check_room_other(room_other,other, compare)
            if "win" in system_info:
                print("room_other",room_other)
            lou = other.replace(room_other,"", 1)
            if "win" in system_info:
                print("128lou",lou)
            lou = clean_lou(lou, compare)
            # åˆ¤æ–­æ¥¼æ˜¯å¦åœ¨æ–°çš„ä½ç½®å¦‚æœæ˜¯è¦ç”¨æ¥¼è·å¾—room_other
            lou, room_other = check_lou_position(lou,room_other,other)
            if "win" in system_info:
                print("y",lou,"room", room_other)
            # status = is_all_number(n)
            # æ£€æŸ¥æ¥¼æ˜¯å¦æ˜¯æ•°å­—
            if "å•å…ƒ" in room_other:
                room = get_room(room_other, other)
                special = room_other.split(room)[0]
                special, key = replace_file(special)
            else:
                room = get_room(room_other, other)
                special = ""
            # æ£€æŸ¥æ˜¯å¦å®¤æ•°å­—åŠ è‹±æ–‡
            break
        # else:
        #     lou = ""
        #     special = ""
        #     room = get_first_number(other)
    if compare_status == False:
        if " " in other:
            if "win" in system_info:
                print("171ç©ºæ ¼", other)
            lou = other.split(" ")[0]
            if "win" in system_info:
                print("172lou",lou)
            result = lou.isdigit()
            if result:
                room = other.split(" ")[1]
                special = ""
            else:
                lou = other.split(" ")[1]
                result = lou.isdigit()
                if result:
                    room = other.split(" ")[2]
                    special = ""
                else:
                    lou = other.split(" ")[2]
                    result = lou.isdigit()
                    if result:
                        room = other.split(" ")[3]
                        special = ""
                    else:
                        lou = ""
                        room = get_first_number(other)
                        special = ""
    louceng = get_louceng(room)
    return lou, special, room, louceng, mobile_number


def get_louceng(part):
    if len(part) == 5:
        reg_str3 = "(\d*)\d{3}"
    else:
        reg_str3 = "(\d*)\d{2}"
    reg3 = re.findall(reg_str3, part)
    if reg3:
        return reg3[0]
    return ""


def clean_lou(lou, compare):
    # todo å¢åŠ  åˆ¤æ–­compareå‡ºç°å‡ æ¬¡.candy
    if "win" in system_info:
        print("177lou",lou)
    if "-" in lou:
        try:
            lou = lou.split(" ")[-1]
        except:
            pass
    else:
        lou, key = replace_file(lou)
        lou = get_first_number(lou)
    if "win" in system_info:
        print("final lou",lou)
    return lou


def check_lou_position(lou,room_other, other):
    if "win" in system_info:
        print(room_other)
    x = get_first_number(room_other)
    if len(x)>1:
        pass
    else:
        room_other = other.split(lou)[1]
    if "win" in system_info:
        print(194,room_other)
    # input("stop")
    return lou, room_other


def get_room(room_other, other):
    if "win" in system_info:
        print(127,room_other)
    room = room_other.split(" ")[0]
    if "win" in system_info:
        print(room)
    status = room.isdigit()
    contain_status = is_contains_number(room)
    if status:
        pass
    elif contain_status:
        if "ç”³é“¶" in other or "æ­¦å®šè·¯327å·" in other:
            room_r = get_first_number_english(room)
        else:
            if "win" in system_info:
                print(248, room)  # 248 å·æ¥¼2903C candyå¦‚æœæ•°å­—åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå­—æ¯å°±æŠŠroomå˜æˆ2903c
            room_r = get_first_number(room)
        if len(room_r) == 1:
            new_room = room.replace(room_r,"",1)
            if "ç”³é“¶" in other or "æ­¦å®šè·¯327å·" in other:
                room = get_first_number_english(new_room)
            else:
                room = get_first_number(new_room)
        else:
            room = room_r

        if "win" in system_info:
            print(212,room)
    else:
        room = room_other.split(" ")[1]
        if "ç”³é“¶" in other or "æ­¦å®šè·¯327å·" in other:
            room = get_first_number_english(room)
        else:
            room = get_first_number(room)
            if len(room)==0:
                room = get_first_number(room_other)
    if "win" in system_info:
        print(143, room)
    return room


def check_room_other(room_other,other, compare):
    if "win" in system_info:
        print(225,"room_other", room_other, compare, other)
    for x in jieci_list:
        room_first = other.replace(room_other,"")
        # print("room_first",room_first)
        if x in room_first:
            # print(x)
            a = other.split(compare)[0]
            room_other = other.replace(a,"")
            break
    if "win" in system_info:
        print(232,room_other)
    first_number = get_first_number(room_other)
    if "win" in system_info:
        print("frist_number",first_number)
    # æœ‰å¯èƒ½æ²¡æœ‰æ•°å­—æˆ–è€…åªæœ‰æ•°å­—  a = " 61. 20-1203-2"
    status = False
    if first_number and len(first_number) > 1:
        status = True
        if "win" in system_info:
            print("ä¸æ”¹,ç”¨æœ€åä¸€ä¸ªæ ‡å¿—ç¬¦å·")
    else:
        for jc in jieci_list:
            if jc in room_other or len(first_number)==1:
                status = True
                x = other.split(compare)[0]
                print("119",x)
                room_other = other.replace(x,"", 1)
                break

    if status:
        pass
    else:
        x = other.split(compare)[0]
        if "win" in system_info:
            print("137",x)
        room_other = other.replace(x,"", 1)
    if "win" in system_info:
        print("167return",room_other)
    return room_other


def get_shuliang(content1):
    # content = "è”¬èœğŸ¥¬ä¸€ä»½"
    # content = "é™å®‰é¢åŒ…å›¢é•¿ 200"

    if "/" in content1:
        a = content1.split("/")[0]
        b = content1.split("/")[1]
        detail, shuliang, status, key = shuliang_divid(a)
        detail1, shuliang1, status, key = shuliang_divid(b,2)
        if "win" in system_info:
            print("b",b)
    else:
        if "win" in system_info:
            print("content1",content1)
        detail, shuliang, status, key = shuliang_divid(content1)
        if status:
            rest = content1.replace(detail,"",1).replace(shuliang,"",1)
        else:
            rest = content1.replace(detail,"",1).replace(key,"",1)
        if "win" in system_info:
            print(316,rest,len(rest))
        if len(rest) > 2:
            if "win" in system_info:
                print(331)
            detail1, shuliang1, status, key = shuliang_divid(rest,2)
            if "win" in system_info:
                print(336,detail1)
        else:
            detail1 = ""
            shuliang1 =""
        if "win" in system_info:
            print(detail, shuliang, detail1, shuliang1)
    return detail, shuliang, detail1,shuliang1


def shuliang_divid(content1,num = ""):
    content, key = replace_file(content1)
    if "win" in system_info:
        print(317,content, key)
    status = False
    if content == content1:
        status = True
        if "win" in system_info:
            print(content)
        shuliang = get_first_number(content)
        if "win" in system_info:
            print(214,shuliang)
        detail = content.split(shuliang)[0]
        detail = detail.replace("å®¤","")
        if "win" in system_info:
            print(shuliang, detail)
        key = ""
    else:
        if "win" in system_info:
            print("key",key)
        detail = content1.split(key)[0]
        shuliang = content1.split(key)[1]
        shuliang, key1 = replace_file(key)
    if num == 2:
        for x in jieci_list:
            detail = detail.replace(x,"")
    return detail, shuliang, status, key


def replace_file(content):
    dic1 = {"ä¸€":"1","å£¹":"1","â… ":"1","äºŒ":"2","ä¸¤":"2","è´°":"2","â…¡":"2","ä¸‰":"3","å":"3","â…¢":"3","å››":"4","è‚†":"4","â…£":"4","äº”":"5","ä¼":"5","â…¤":"5","å…­":"6","é™†":"6","â…¥":"6","ä¸ƒ":"7","æŸ’":"7","â…¦":"7","å…«":"8","æŒ":"8","â…§":"8","ä¹":"9","ç–":"9","â…¨":"9","å":"10","æ‹¾":"10","â…©":"10","ç™¾":"100","ä½°":"100","åƒ":"1000","ä»Ÿ":"1000"}  # todo
    status = False
    for key, value in dic1.items():
        # print(key,value)
        if key in content:
            if "win" in system_info:
                print(key)
            status = True
            content = content.replace(key, value)
            if "win" in system_info:
                print(content)
            break
    if status:
        pass
    else:
        key = ""
    return content, key


#æ£€éªŒæ˜¯å¦å…¨æ˜¯ä¸­æ–‡å­—ç¬¦
def is_all_chinese(strs):
    for _char in strs:
        if not '\u4e00' <= _char <= '\u9fa5':
            return False
    return True

#---------------------------------------------------------------------------------------

#æ£€éªŒæ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦
def is_contains_chinese(strs):
    for _char in strs:
        if '\u4e00' <= _char <= '\u9fa5':
            return True
    return False

#æ£€éªŒæ˜¯å¦åŒ…å«æ•°å­—
def is_contains_number(strs):
    # str = 'å·'
    pattern = re.compile('[0-9]+')
    match = pattern.findall(strs)
    if match:
        print ('contains digital')
        return True
    else:
        print ('not contains digital')
        return False


def get_first_number_english(code):
    # code ='"msg"222333eff:"æŸ¥è¯¢æˆ333åŠŸ!","v_code":"175177","errCode":0,"v_type":"sld"'
    need = ".*?([0-9]+[a-zA-Z]+).*"
    match_obj = re.match(need,code)
    if match_obj:
        xx = match_obj.group(1)
        print(xx)
    else:
        xx = ""
    return xx


def get_first_number(code):
    xx = ""
    # code = "å· 1703 ä¸€ä»½"
    # code ='"msg"222333e:"æŸ¥è¯¢æˆ333åŠŸ!","v_code":"175177","errCode":0,"v_type":"sld"'
    # print(type(code))
    need = ".*?([0-9]+).*"
    match_obj = re.match(need,code)
    if match_obj:
        xx = match_obj.group(1)
    print("get_first_number",xx)
    return xx


def drop_special_character(code):
    # code = 'åŒ—åŒº-533-2-eee'
    # need = ".*?([0-9]+[a-zA-Z]+).*"
    xx = ""
    need = "\d.*"
    match_obj = re.search(need,code)
    if match_obj:
        xx = match_obj.group()
        print(308,xx)
    return xx


def get_last_number(code):
    # code ='"msg"222:"æŸ¥è¯¢æˆ333åŠŸ!","v_code":"175177","errCode":0333,"v_type":"sld"'
    xx = ""
    # print(type(code))
    need = "([0-9]+)"
    match_obj = re.findall(need,code)
    if match_obj:
        xx = match_obj[-1]
        print(xx)
    return xx


def mobile(line):
    # line="3errr18902144452fff"
    regex_str="(1[34578]\\d{9})"
    match_obj = re.findall(regex_str,line)
    match_obj = "".join(match_obj)
    print(match_obj)
    return match_obj


def drop_chinese(code):
    code = 'åŒ—åŒº-5'
    match_obj = re.sub('[\u4e00-\u9fa5]', '', code)
    print(match_obj)


def exceution():
    a_list =[" 9. 2å·æ¥¼2å•å…ƒ703 èœä¸€ä»½"," 6. 2ä¸€ä¸¨ä¸€403 èœä¸€ä»½"," 12. 2ï¼2ï¼803 èœ ä¸€ä»½"," 7. è°¢ 27å·102å®¤","ä¸Šæµ·å¸‚é™å®‰åŒºç”³é“¶å‘å±•å¤§å¦1æ ‹1304æˆ¿Eæˆ¿", "6. 8âˆ’301 349ä¸€å¥— 315ä¸€å¥—"," 20. æ°´æ™¶æºªç 780-1201-3å¥—","15. 760#309 2å¥—", "2. 98-201 è”¬èœä¸€ä»½", " 11. 10å·403  ä¸€ä»½", "1. 4-301", " 10. 760-710å®¤ å°æ¨  äºŒå¥—", " 8. 760#1106yan 1å¥—", "8. 69â€“402å®¤  è”¬èœğŸ¥¬ä¸€ä»½", " 15. æ²ˆä¼Ÿä¼Ÿ 92-402 è”¬èœä¸€ä»½", "ä¸Šæµ·å¸‚ä¸Šæµ·å¸‚æ™®é™€åŒºåŒæ™®è·¯1441å¼„1å·301å®¤", " 6. åŒ—åŒº1å·505", " 10. åŒ—åŒº-5-1702 1ä»½2ç“¶", "14. 3å·1902é™å®‰é¢åŒ…å›¢é•¿ 200", " 10. 760-710å®¤ å°æ¨  äºŒå¥—"]
    result = []
    debug = False
    for a in a_list:
        item = get_info(a, debug)
        result.append(item)
    df = pd.DataFrame(result)
    df.to_excel("df.xlsx")
    print(df)


if __name__ == '__main__':
    code="158å¥—é¤1ä»½"
    # status = is_contains_number(strs)
    # print("status",status)
    # check()
    # mobile()
    get_info(code,True)
    # get_last_number(code)
    # get_shuliang(code)
    # exceution()
    # get_last_number(code)
    # get_first_number(code)
    # is_contains_number(code)
